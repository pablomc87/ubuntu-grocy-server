#cloud-config
hostname: ${hostname}
manage_etc_hosts: true
packages:
- avahi-daemon
apt:
  conf: |
    Acquire {
      Check-Date "false";
    };

users:
- name: ${server_user}
  groups: users,adm,netdev,sudo,docker
  shell: /bin/bash
  lock_passwd: false
  passwd: ${password_hash}
  ssh_authorized_keys:
    - ${ssh_key}
  sudo: ALL=(ALL) NOPASSWD:ALL

timezone: Europe/Paris
keyboard:
  model: pc105
  layout: es
ansible:
  package_name: ansible-core
  install_method: distro
  pull:
    url: "${repo_url}"
    playbook_name: main.yml
    inventory: inventory.yml
    directory: /opt/ansible-pull
    clean: true

runcmd:
- localectl set-x11-keymap "us" pc105
- setupcon -k --force || true
- mkdir -p /opt/ansible-pull
- cp /tmp/inventory.yml /opt/ansible-pull/inventory.yml
- cp /tmp/inventory-generated.yml /opt/ansible-pull/inventory-generated.yml
